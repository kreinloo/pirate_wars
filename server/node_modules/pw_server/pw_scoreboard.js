/*

	pw_scoreboard.js

*/

var util = require("util");

Scoreboard = function (server) {

	this.server = server;
	
	this.round = function (num, dec) {
		return (Math.round(num*Math.pow(10, dec)) / Math.pow(10, dec));
	};
	
	this.pushScores = function (socket) {
		var db = server.getDB();
		var scores = [];
		var round = this.round;
		db.getStmt("SCOREBOARD").all(function(err, rows) {
			for (var i = 0; i < rows.length; i++) {
				var row = rows[i];
				scores.push({
					username : row.username,
					wins : row.wins,
					losses : row.losses,
					ratio : round(row.ratio, 2)
				});
			}
			if (DEBUG.SERVER)
				util.debug(SCOREBOARD.DATA + " " + JSON.stringify(scores));
			server.emitScoreboard(scores, socket);
		});
	};
	
};
