/*

	pw_database.js

*/

var util = require("util");
var sqlite = require("sqlite3");

Database = function (databaseFile) {
	var db = null;
	var statements = {};

	// Fails ungracefully if databaseFile doesn't exist.
	if (DEBUG.DATABASE)
		util.debug("Opening database file '" + databaseFile + "'.");
	db = new sqlite.Database(databaseFile, sqlite.OPEN_READWRITE);
	
	/*
		Prepares SQL statements for later use.
		Faster (precompiled) and more secure (injections not possible).
	*/
	if (DEBUG.DATABASE)
		util.debug("Preparing SQL statements.");

	// Returns id if player with supplied username exists.
	statements["CHECK_PLAYER"] =
		db.prepare("SELECT id FROM pw_player WHERE username=?;");
	// Inserts a new player into database.
	statements["ADD_PLAYER"] =
		db.prepare("INSERT INTO pw_player VALUES(NULL, ?);");
	// Inserts a new game into database (first argument winner, second loser).
	statements["ADD_GAME"] =
		db.prepare("INSERT INTO pw_game VALUES(NULL, NULL, ?, ?);");
	// Returns scoreboard.
	statements["SCOREBOARD"] =
		db.prepare("SELECT username, wins, losses, ratio FROM pw_scoreboard;");

	this.getStmt = function (statement) {
		return statements[statement];
	};

};
