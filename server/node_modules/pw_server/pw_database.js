/*

	pw_database.js

*/

var util = require("util");
var sqlite = require("sqlite3").verbose(); // Verbose for debugging!

Database = function (databaseFile) {

	"use strict";

	var db = null;
	var statements = null;

	// Fails ungracefully if databaseFile doesn't exist.
	if (DEBUG.DATABASE)
		util.debug("Opening database file '" + databaseFile + "'.");
	db = new sqlite.Database(databaseFile, sqlite.OPEN_READWRITE);

	/*
		Prepares SQL statements for later use.
		Faster (precompiled) and more secure (injections not possible).
	*/
	if (DEBUG.DATABASE)
		util.debug("Preparing SQL statements.");
		
	var statements = {
		// Returns id if player with supplied username exists.
		CHECK_PLAYER	:	db.prepare("SELECT id FROM pw_player WHERE username=?;"),
		// Inserts a new player into database.
		ADD_PLAYER		:	db.prepare("INSERT INTO pw_player VALUES(NULL, ?);"),
		// Inserts a new game into database (first argument winner, second loser).
		ADD_GAME			:	db.prepare("INSERT INTO pw_game (winner, loser) VALUES(?, ?);"),
		// Returns scoreboard.
		SCOREBOARD		:	db.prepare("SELECT username, wins, losses, ratio FROM pw_scoreboard LIMIT 20;")
	};

	this.getStmt = function (statement) {
		return statements[statement];
	};

};
