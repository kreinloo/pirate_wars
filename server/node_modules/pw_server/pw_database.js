/*

	pw_database.js

*/

var util = require("util");
var sqlite = require("sqlite3");

PW_Database = function (databaseFile) {
	var db = null;
	var statements = {};

	// Fails ungracefully if databaseFile doesn't exist.
	db = new sqlite.Database(databaseFile, sqlite.OPEN_READWRITE);
	if (DEBUG.SERVER)
		util.debug("Database '" + databaseFile + "' opened.");
		
	/*
		Prepares SQL statements for later use.
		Faster (precompiled) and more secure (injections not possible).
	*/
	
	// Returns id if player with supplied username exists.
	statements["CHECK_PLAYER"] =
			db.prepare("SELECT id FROM pw_player WHERE username=?;");
	// Inserts a new player into database.
	statements["ADD_PLAYER"] =
			db.prepare("INSERT INTO pw_player VALUES(NULL, ?);");
	// Inserts a new game into database (first argument winner, second loser).
	statements["ADD_GAME"] =
			db.prepare("INSERT INTO pw_game VALUES(NULL, NULL, ?, ?);");
	if (DEBUG.SERVER)
		util.debug("SQL Statements prepared.");
	
	this.getStmt = function (statement) {
		return statements[statement];
	};
		
};
